<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <title>10 Frame Math</title>
  </head>
  <body>

    <div class="container">
        <div class="row">
          <div class="col-12">
            <h5 class="text-muted mt-0 mb-0">10 Frame Math</h5>
          </div>
        </div>

        <div class="row">
            <div class="col-2">
                <div class="display-3 mt-0 mb-3 numbers" id="left-term">?</div>
            </div>  
            <div class="col-2">
                <div class="display-4 mt-2 ml-3">+</div>
            </div>  
            <div class="col-2">
              <div class="display-3 mt-0 mb-3 numbers" id="right-term">?</div>
            </div>
            <div class="col-2">
                <div class="display-4 mt-2 ml-3">=</div>
            </div>
            <div class="col-2">
                <div class="display-3 mt-0 mb-3 numbers" id="answer-term">?</div>
            </div>
            <div class="col-2">
              &nbsp;
            </div>
        </div>

        <div class="row">
            <div class="col-2">
              <div id="left-items-0-to-9" class="grid-container">
                <div id="left-item-0" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-1" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-2" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-3" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-4" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-5" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-6" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-7" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-8" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-9" class="grid-item"><span class="blank-term-dot"></span></div>
              </div>
              <br/>
              <div id="left-items-10-to-19" class="grid-container collapse">
                <div id="left-item-10" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-11" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-12" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-13" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-14" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-15" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-16" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-17" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-18" class="grid-item"><span class="blank-term-dot"></span></div>
                <div id="left-item-19" class="grid-item"><span class="blank-term-dot"></span></div>
              </div>
            </div>  
            <div class="col-2"></div>  
            <div class="col-2">
                <div id="right-items-0-to-9" class="grid-container">
                  <div id="right-item-0" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-1" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-2" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-3" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-4" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-5" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-6" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-7" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-8" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-9" class="grid-item"><span class="blank-term-dot"></span></div>
                </div>  
                <br/>
                <div id="right-items-10-to-19" class="grid-container collapse">
                  <div id="right-item-10" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-11" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-12" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-13" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-14" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-15" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-16" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-17" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-18" class="grid-item"><span class="blank-term-dot"></span></div>
                  <div id="right-item-19" class="grid-item"><span class="blank-term-dot"></span></div>
                </div>  
            </div>
            <div class="col-2"></div>
            <div class="col-2">
              <div id="answer-items-0-to-9" class="grid-container">
                <div id="answer-item-0" class="grid-item"><span class="blank-term-dot" id="answer-dot-0"></span></div>
                <div id="answer-item-1" class="grid-item"><span class="blank-term-dot" id="answer-dot-1"></span></div>
                <div id="answer-item-2" class="grid-item"><span class="blank-term-dot" id="answer-dot-2"></span></div>
                <div id="answer-item-3" class="grid-item"><span class="blank-term-dot" id="answer-dot-3"></span></div>
                <div id="answer-item-4" class="grid-item"><span class="blank-term-dot" id="answer-dot-4"></span></div>
                <div id="answer-item-5" class="grid-item"><span class="blank-term-dot" id="answer-dot-5"></span></div>
                <div id="answer-item-6" class="grid-item"><span class="blank-term-dot" id="answer-dot-6"></span></div>
                <div id="answer-item-7" class="grid-item"><span class="blank-term-dot" id="answer-dot-7"></span></div>
                <div id="answer-item-8" class="grid-item"><span class="blank-term-dot" id="answer-dot-8"></span></div>
                <div id="answer-item-9" class="grid-item"><span class="blank-term-dot" id="answer-dot-9"></span></div>
              </div>  
              <br/>
              <div id="answer-items-10-to-19" class="grid-container collapse">
                <div id="answer-item-10" class="grid-item"><span class="blank-term-dot" id="answer-dot-10"></span></div>
                <div id="answer-item-11" class="grid-item"><span class="blank-term-dot" id="answer-dot-11"></span></div>
                <div id="answer-item-12" class="grid-item"><span class="blank-term-dot" id="answer-dot-12"></span></div>
                <div id="answer-item-13" class="grid-item"><span class="blank-term-dot" id="answer-dot-13"></span></div>
                <div id="answer-item-14" class="grid-item"><span class="blank-term-dot" id="answer-dot-14"></span></div>
                <div id="answer-item-15" class="grid-item"><span class="blank-term-dot" id="answer-dot-15"></span></div>
                <div id="answer-item-16" class="grid-item"><span class="blank-term-dot" id="answer-dot-16"></span></div>
                <div id="answer-item-17" class="grid-item"><span class="blank-term-dot" id="answer-dot-17"></span></div>
                <div id="answer-item-18" class="grid-item"><span class="blank-term-dot" id="answer-dot-18"></span></div>
                <div id="answer-item-19" class="grid-item"><span class="blank-term-dot" id="answer-dot-19"></span></div>
              </div>  
              <br/>
              <div id="answer-items-20-to-29" class="grid-container collapse">
                <div id="answer-item-20" class="grid-item"><span class="blank-term-dot" id="answer-dot-20"></span></div>
                <div id="answer-item-21" class="grid-item"><span class="blank-term-dot" id="answer-dot-21"></span></div>
                <div id="answer-item-22" class="grid-item"><span class="blank-term-dot" id="answer-dot-22"></span></div>
                <div id="answer-item-23" class="grid-item"><span class="blank-term-dot" id="answer-dot-23"></span></div>
                <div id="answer-item-24" class="grid-item"><span class="blank-term-dot" id="answer-dot-24"></span></div>
                <div id="answer-item-25" class="grid-item"><span class="blank-term-dot" id="answer-dot-25"></span></div>
                <div id="answer-item-26" class="grid-item"><span class="blank-term-dot" id="answer-dot-26"></span></div>
                <div id="answer-item-27" class="grid-item"><span class="blank-term-dot" id="answer-dot-27"></span></div>
                <div id="answer-item-28" class="grid-item"><span class="blank-term-dot" id="answer-dot-28"></span></div>
                <div id="answer-item-29" class="grid-item"><span class="blank-term-dot" id="answer-dot-29"></span></div>
              </div>  
            </div>
        </div>

        <div class="row">
          <div class="col-10">
              <h5>Select an answer....</h5>
          </div>
        </div>

        <div class="row">          
            <div class="col-4">
              <button class="favorite styled answer-button" type="button" id="answer-button-0" onclick="showAnswer(this)">Answer 1</button>
            </div>
            <div class="col-4">
              <button class="favorite styled answer-button" type="button" id="answer-button-1" onclick="showAnswer(this)">Answer 2</button>
            </div>
            <div class="col-4">
              <button class="favorite styled answer-button" type="button" id="answer-button-2" onclick="showAnswer(this)">Answer 3</button>
            </div>
        </div>

        <br/>

        <div class="row">
          <div class="col-12 collapse" id="correctmsg">
            <div class="alert alert-success" role="alert">
              <h4 class="alert-heading text-center">Well done!</h4>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12 collapse" id="oopsmsg">
            <div class="alert alert-danger" role="alert">
              <h4 class="alert-heading text-center">Oops!</h4>
            </div>    
          </div>
        </div>

        <div class="row">
          <div class="col-10 collapse" id="nextquestion" >
            <button type="button" class="btn btn-dark" onclick="location.reload();">Next Question</button>
          </div>
        </div>

    </div>

  </body>

  <script type="module">

    import anime from './anime.es.js';

    // Determines how tough the questions are.   Possible values are 1 and 2.
    var QUESTION_LEVEL = 1;

    class Animation {
      constructor(elementName, deltaX, deltaY) {
        this.elementName = elementName;
        this.deltaX = deltaX;
        this.deltaY = deltaY;
      }
    }

    class Question {
      constructor(leftTerm, rightTerm, answerTerm, possibleAnswers) {
        this.leftTerm = leftTerm;
        this.rightTerm = rightTerm;
        this.answerTerm = answerTerm;
        this.possibleAnswers = possibleAnswers;
      }
    }

    class Terms {
      constructor(leftTerm, rightTerm) {
        this.leftTerm = leftTerm;
        this.rightTerm = rightTerm;
      }
    }

    function addToTimeline(timeline, animations, offset) {
      // Play all animations
      var i;
      var animation;

      for (i = 0; i < animations.length; i++) {

        timeline.add( {
          targets: animations[i].elementName,
          // Properties 
          translateX: (animations[i].deltaX),
          translateY: (animations[i].deltaY),
          borderRadius: 50,
          // Property Parameters
          duration: 2000,
          easing: 'linear',
          // Animation Parameters
          direction: 'normal'

        }, offset);
      }
    };

    function fillInDots(eleItemNamePrefix, eleTermNamePrefix, termValue) {
      var i;
      for (i = 0; i < termValue; i++) {
        // Find item and child placeholder
        var eleName = eleItemNamePrefix + "-" + i;
        var itemEle = document.getElementById(eleName);

        // Create new element
        var dotEle = document.createElement("SPAN");
        dotEle.className = eleTermNamePrefix + "-dot";
        dotEle.id = eleTermNamePrefix + "-dot-" + i;
        dotEle.style.zIndex = 1;

        // Replace placeholder child with new element
        itemEle.replaceChild(dotEle, itemEle.lastChild);
      } 
    };

    function calcAnimations(termValue, offsetValue, dotEleNamePrefix) {
      var animations = new Array();
      var i, j;

      for (i = 0, j=offsetValue+i; i < termValue; i++, j++) {
        // Find item and child placeholder
        var eleName = dotEleNamePrefix + "-" + i;
        var dotEle = document.getElementById(eleName);
        var termRect = dotEle.getBoundingClientRect();

        var ansDotEleName = "answer-dot-" + j;
        var ansDotEle = document.getElementById(ansDotEleName);
        var answerRect = ansDotEle.getBoundingClientRect();

        var animation = new Animation("#" + eleName, (answerRect.left - termRect.left), (answerRect.top - termRect.top));
        animations.push(animation);
      }

      return animations;
    }

    function generateQuestion() {

      var terms = (QUESTION_LEVEL==2)?generateLevel2Terms():generateLevel1Terms();
      var answerTerm = terms.leftTerm + terms.rightTerm;

      // Calc an offset that belongs to the set of [-1, 0, 1]
      var offsetCoeff = Math.random();
      var offset = (offsetCoeff < .333)?-1:(offsetCoeff < .666)?0:1;
      var answerPlusOffset = answerTerm + offset;
      var possibleAnswers = [answerPlusOffset - 1, answerPlusOffset, answerPlusOffset + 1];

      return new Question(terms.leftTerm, terms.rightTerm, answerTerm, possibleAnswers);
    }

    function generateLevel1Terms() {
      // Calc left and right terms
      var leftTerm = generateRandom(10);
      var rightTerm = generateRandom(10);

      return new Terms(leftTerm, rightTerm);
    }

    function generateLevel2Terms() {
      // Calc left and right terms
      var leftTerm = generateRandom(20);
      var rightTerm = generateRandom(30 - leftTerm);

      return new Terms(leftTerm, rightTerm);
    }

    // Will generate a random whole number from 0 to maxValue
    function generateRandom(maxValue) {
      return Math.floor(Math.random() * (maxValue + 1));    // add 1 to offset floor
    }

    function wrapup(answerTermEle, answerTermValue, iscorrect) {
      answerTermEle.innerHTML = answerTermValue;

      (iscorrect == 'true')?$('#correctmsg').collapse('show'):$('#oopsmsg').collapse('show');
      $('#nextquestion').collapse('show')
    }

    function setupAnswerButton(answerButtonName, possibleAnswerValue, actualAnswerValue) {
      var answerButton = document.getElementById(answerButtonName);
      answerButton.innerHTML = possibleAnswerValue;
      answerButton.setAttribute("data-is-correct", (possibleAnswerValue == actualAnswerValue));
    }

    function runAnimation(iscorrect) {
      // Calculate translations for left
      var leftAnimations = calcAnimations(leftTermValue, 0, "left-term-dot");
      var rightAnimations = calcAnimations(rightTermValue, leftTermValue, "right-term-dot");

      // Create a timeline with default parameters
        var timeline = anime.timeline({
          easing: 'easeOutExpo',
          duration: 4000
      });

      // Calc time offsets
      var leftAnimationDelay = 0;
      var rightAnimationDelay = (leftAnimations.length == 0)?0:2000;
      var wrapUpDelay = ((rightAnimations.length == 0)?rightAnimationDelay:rightAnimationDelay+1700) + 300;

      // Place animations on timeline
      var animationLeft = addToTimeline(timeline, leftAnimations, leftAnimationDelay);
      var animationRight = addToTimeline(timeline, rightAnimations, rightAnimationDelay);

      // Fill in answer on DOM
      setTimeout(wrapup, wrapUpDelay, answerTermEle, answerTermValue, iscorrect);
    }
    // Make this method available from the main page
    window.runAnimation = runAnimation;

    // Get DOM elements for equation
    var leftTermEle = document.getElementById("left-term");
    var rightTermEle = document.getElementById("right-term");
    var answerTermEle = document.getElementById("answer-term");

    // Generate question 
    var question = generateQuestion();
    var leftTermValue = question.leftTerm;
    var rightTermValue = question.rightTerm;
    var answerTermValue = question.answerTerm;

    // Show extra ten frames as necessary
    if (leftTermValue > 10) {
      $('#left-items-10-to-19').collapse('show');
    }
    if (rightTermValue > 10) {
      $('#right-items-10-to-19').collapse('show');
    }
    var maxPossibleAnswerValue = Math.max.apply(Math,question.possibleAnswers);
    if (maxPossibleAnswerValue > 10) {   
      $('#answer-items-10-to-19').collapse('show');
    }
    if (maxPossibleAnswerValue > 20) {   
      $('#answer-items-20-to-29').collapse('show');
    }
    

    // Fill in left and right term values on the page
    leftTermEle.innerHTML = leftTermValue;
    rightTermEle.innerHTML = rightTermValue;

    // Fill in ten frame dots 
    fillInDots("left-item", "left-term", leftTermValue);
    fillInDots("right-item", "right-term", rightTermValue);

    // Fill in answers to buttons
    setupAnswerButton("answer-button-0", question.possibleAnswers[0], answerTermValue);
    setupAnswerButton("answer-button-1", question.possibleAnswers[1], answerTermValue);
    setupAnswerButton("answer-button-2", question.possibleAnswers[2], answerTermValue);

  </script>

  <script type="text/javascript">
      function showAnswer(button) {
        // Highlight button selected
        button.style.backgroundColor = "#FF69B4";

        // Disable all buttons        
        $( ".answer-button").prop("disabled", true);

        // Run animation
        runAnimation(button.getAttribute("data-is-correct"));
      }
  </script>

</html>